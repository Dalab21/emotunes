#:import utils kivy.utils
#:import ew kivy.uix.effectwidget
#:set color1 "#DD7835"
#:set color2 "#C8C8C8"
#:kivy 2.0.0

ScreenManagement:
    MainScreen:
        name: "main"
    LoginScreen:
        name: 'login'
    SignUpScreen:
        name: 'signup'
    SpaceScreen:
        name: "space"
    CaptureScreen:
        name: 'capture'
    EmotionScreen:
        name: 'emotion'
    PlaylistEmotionScreen:
        name: 'playlist'
    HistoricScreen:
        name: 'historic'
    PlaylistDetailScreen:
        name: 'playlist_detail'
    PlayerSongScreen:
        name: 'player'

<MainScreen>:
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1
        Image:
            source: "assets/logo_emo.png"
            pos_hint: {"center_y": .8}
        MDLabel:
            text: "emoTunes"
            font_name: "BPoppins"
            font_size: "23sp"
            pos_hint: {"center_y": .60}
            halign: "center"
            color: rgba(34, 34, 34, 255)
        Button:
            text: "LOGIN"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .50}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "login"
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]
        Button:
            text: "SIGNUP"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .40}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "signup"
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]

<LoginScreen>:
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1
        MDIconButton:
            icon: "arrow-left"
            pos_hint: {"center_y": .95}
            user_font_size: "30sp"
            theme_text_color: "Custom"
            text_color: rgba(26, 24, 58, 255)
            on_release:
                root.manager.transition.direction = "right"
                root.manager.current = "main"
        MDLabel:
            text: "B O N J O U R !"
            font_name: "BPoppins"
            font_size: "24sp"
            pos_hint: {"center_x": .6, "center_y": .85}
            color: rgba(0, 0, 59, 255)
        MDLabel:
            text: "Connectez vous pour continuer"
            font_name: "MPoppins"
            font_size: "15sp"
            pos_hint: {"center_x": .6, "center_y": .79}
            color: rgba(135, 133, 193, 255)
        MDFloatLayout:
            size_hint: .7, .07
            pos_hint: {"center_x": .5, "center_y": .63}
            TextInput:
                id: username
                hint_text: "Username"
                font_name: "MPoppins"
                size_hint_y: .75
                pos_hint: {"center_x": .43, "center_y": .5}
                background_color: 1, 1, 1, 0
                foreground_color: rgba(0, 0, 59, 255)
                cursor_color: rgba(0, 0, 59, 255)
                font_size: "14sp"
                cursor_width: "2sp"
                multiline: False
        MDFloatLayout:
            pos_hint: {"center_x": .45, "center_y": 0}
            size_hint_y: .03
            md_bg_color: rgba(178, 178, 178, 255)
        MDFloatLayout:
            size_hint: .7, .07
            pos_hint: {"center_x": .5, "center_y": .5}
            TextInput:
                id: password
                hint_text: "Password"
                font_name: "MPoppins"
                size_hint_y: .75
                pos_hint: {"center_x": .43, "center_y": .5}
                background_color: 1, 1, 1, 0
                foreground_color: rgba(0, 0, 59, 255)
                cursor_color: rgba(0, 0, 59, 255)
                font_size: "14sp"
                cursor_width: "2sp"
                multiline: False
                password: True
            MDFloatLayout:
                pos_hint: {"center_x": .45, "center_y": 0}
                size_hint_y: .03
                md_gb_color: rgba(178, 178, 178, 255)
        Button:
            text: "LOGIN"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .34}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            on_release:
                root.login_user(username.text, password.text)
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]
        MDTextButton:
            text: "Mot de passe oublié?"
            pos_hint: {"center_x": .5, "center_y": .28}
            color: rgba(68, 78, 132, 255)
            font_size: "12sp"
            font_name: "BPoppins"
        MDLabel:
            text: "ou"
            color: rgba(52, 0, 231, 255)
            pos_hint: {"center_y": .22}
            font_size: "13sp"
            font_name: "BPoppins"
            halign: "center"
        MDFloatLayout:
            md_bg_color: rgba(178, 178, 178, 255)
            size_hint: .3, .002
            pos_hint: {"center_x": .3, "center_y": .218}
        MDFloatLayout:
            md_bg_color: rgba(178, 178, 178, 255)
            size_hint: .3, .002
            pos_hint: {"center_x": .7, "center_y": .218}
        MDLabel:
            text: "Autres modes de Login"
            font_name: "BPoppins"
            font_size: "13sp"
            halign: "center"
            pos_hint: {"center_y": .16}
            color: rgba(135, 133, 193, 255)
        MDGridLayout:
            cols: 3
            size_hint: .48, .07
            pos_hint: {"center_x": .5, "center_y": .1}
            Image:
                source: "assets/google.png"
            Image:
                source: "assets/facebook.png"
            Image:
                source: "assets/spotify.png"
        MDLabel:
            text: "Pas de compte?"
            font_name: "BPoppins"
            font_size: "11sp"
            pos_hint: {"center_x": .68, "center_y": .04}
            color: rgba(135, 133, 193, 255)
        MDTextButton:
            text: "Sign up"
            font_name: "BPoppins"
            font_size: "11sp"
            pos_hint: {"center_x": .75, "center_y": .04}
            color: rgba(52, 0, 231, 255)
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "signup"


<SignupScreen>:
    name: "signup"
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1

        MDIconButton:
            icon: "arrow-left"
            pos_hint: {"center_y": .95}
            user_font_size: "30sp"
            theme_text_color: "Custom"
            text_color: rgba(26, 24, 58, 255)
            on_release:
                root.manager.transition.direction = "right"
                root.manager.current = "main"

        MDLabel:
            text: "BONJOUR !"
            font_name: "BPoppins"
            font_size: "26sp"
            pos_hint: {"center_x": .6, "center_y": .85}
            color: rgba(0, 0, 59, 255)

        MDLabel:
            text: "Créer un nouveau compte"
            font_name: "MPoppins"
            font_size: "18sp"
            pos_hint: {"center_x": .6, "center_y": .79}
            color: rgba(135, 133, 193, 255)

        MDFloatLayout:
            size_hint: .7, .07
            pos_hint: {"center_x": .5, "center_y": .68}
            TextInput:
                id: username_input
                hint_text: "Username"
                font_name: "MPoppins"
                size_hint_y: .75
                pos_hint: {"center_x": .43, "center_y": .5}
                background_color: 1, 1, 1, 0
                foreground_color: rgba(0, 0, 59, 255)
                cursor_color: rgba(0, 0, 59, 255)
                font_size: "14sp"
                cursor_width: "2sp"
                multiline: False
            MDFloatLayout:
                pos_hint: {"center_x": .45, "center_y": 0}
                size_hint_y: .03
                md_bg_color: rgba(178, 178, 178, 255)

        MDFloatLayout:
            size_hint: .7, .07
            pos_hint: {"center_x": .5, "center_y": .56}
            TextInput:
                id: email_input
                hint_text: "Email"
                font_name: "MPoppins"
                size_hint_y: .75
                pos_hint: {"center_x": .43, "center_y": .5}
                background_color: 1, 1, 1, 0
                foreground_color: rgba(0, 0, 59, 255)
                cursor_color: rgba(0, 0, 59, 255)
                font_size: "14sp"
                cursor_width: "2sp"
                multiline: False
            MDFloatLayout:
                pos_hint: {"center_x": .45, "center_y": 0}
                size_hint_y: .03
                md_bg_color: rgba(178, 178, 178, 255)

        MDFloatLayout:
            size_hint: .7, .07
            pos_hint: {"center_x": .5, "center_y": .44}
            TextInput:
                id: password_input
                hint_text: "Password"
                font_name: "MPoppins"
                size_hint_y: .75
                pos_hint: {"center_x": .43, "center_y": .5}
                background_color: 1, 1, 1, 0
                foreground_color: rgba(0, 0, 59, 255)
                cursor_color: rgba(0, 0, 59, 255)
                font_size: "14sp"
                cursor_width: "2sp"
                multiline: False
                password: True
            MDFloatLayout:
                pos_hint: {"center_x": .45, "center_y": 0}
                size_hint_y: .03
                md_bg_color: rgba(178, 178, 178, 255)

        Button:
            text: "SIGNUP"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .3}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            on_release:
                root.signup(username_input.text, email_input.text, password_input.text)
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]

        MDLabel:
            text: "ou"
            color: rgba(52, 0, 231, 255)
            pos_hint: {"center_y": .22}
            font_size: "13sp"
            font_name: "BPoppins"
            halign: "center"

        MDFloatLayout:
            md_bg_color: rgba(178, 178, 178, 255)
            size_hint: .3, .002
            pos_hint: {"center_x": .3, "center_y": .218}

        MDFloatLayout:
            md_bg_color: rgba(178, 178, 178, 255)
            size_hint: .3, .002
            pos_hint: {"center_x": .7, "center_y": .218}

        MDLabel:
            text: "Autres modes de Login"
            font_name: "BPoppins"
            font_size: "13sp"
            halign: "center"
            pos_hint: {"center_y": .16}
            color: rgba(135, 133, 193, 255)

        MDGridLayout:
            cols: 3
            size_hint: .48, .07
            pos_hint: {"center_x": .5, "center_y": .1}
            Image:
                source: "assets/google.png"
            Image:
                source: "assets/facebook.png"
            Image:
                source: "assets/spotify.png"

        MDLabel:
            text: "Vous avez un compte?"
            font_name: "BPoppins"
            font_size: "11sp"
            pos_hint: {"center_x": .68, "center_y": .04}
            color: rgba(135, 133, 193, 255)

        MDTextButton:
            text: "Login"
            font_name: "BPoppins"
            font_size: "11sp"
            pos_hint: {"center_x": .75, "center_y": .04}
            color: rgba(52, 0, 231, 255)
            on_release:
                root.manager.transition.direction = "right"
                root.manager.current = "login"
            canvas.before:
                Color:
                    rgb: 1, 1, 1, 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]



<SpaceScreen>:
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1
        Image:
            source: "assets/logo_emo1.png"
            pos_hint: {"center_x": .18, "center_y": .95}
        Image:
            source: "assets/space.png"
            size_hint: .8, .8
            pos_hint: {"center_x": .10, "center_y": .85}
        MDLabel:
            text: "ESPACE PERSONNEL"
            font_name: "BPoppins"
            font_size: "28sp"
            pos_hint: {"center_y": .68}
            halign: "center"
            color: rgba(34, 34, 34, 255)
        MDLabel:
            text: f" Bienvenue [color=#ff0000][b]{root.username}[/b][/color] !"  # Utilisation de balises de marquage
            font_name: "MPoppins"
            font_size: "25sp"
            size_hint_x: .85
            pos_hint: {"center_x": .5, "center_y": .50}
            halign: "center"
            color: rgba(127, 127, 127, 255)
            markup: True

        Button:
            text: "PLAY MUSIC"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .28}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "capture"  # Changement de l'écran cible
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [5]
        Button:
            text: "HISTORIC"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .18}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            color: rgba(52, 0, 231, 255)
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "historic"
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                Line:
                    width: 1.2
                    rounded_rectangle: self.x, self.y, self.width, self.height, 5, 5, 5, 5, 100
        Button:
            text: "LOGOUT"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .09}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            color: rgba(52, 0, 231, 255)
            on_release:
                app.logout()
            canvas.before:
                Color:
                    rgb: rgba(52, 0, 231, 255)
                Line:
                    width: 1.2
                    rounded_rectangle: self.x, self.y, self.width, self.height, 5, 5, 5, 5, 100


<CaptureScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)
        canvas.before:
            Color:
                rgba: 1, 1, 1, 0.95  # Fond blanc avec légère opacité grise
            Rectangle:
                pos: self.pos
                size: self.size

        MDLabel:
            text: "SMART CAMERA"
            font_name: "BPoppins"
            font_size: "24sp"
            halign: "center"
            color: 0.2, 0.2, 0.2, 1  # Gris foncé
            size_hint_y: None
            height: dp(40)

        Camera:
            id: camera
            resolution: (640, 480)
            play: True

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            CustomButton:
                text: "CAPTURE"
                on_press: root.capture()

            CustomButton:
                text: "DASHBOARD"
                on_release:
                    root.manager.transition.direction = "left"
                    root.manager.current = "space"

        Label:
            text: root.error_message
            color: 1, 0, 0, 1  # Rouge pour les erreurs
            size_hint: 1, None
            height: self.texture_size[1]
            pos_hint: {'center_x': .5, 'top': .95}

        MDLabel:
            text: " (*) emoDetect analyse les caractéristiques du visage pour déterminer l'humeur "
            font_name: "BPoppins"
            font_size: "8sp"
            halign: "center"
            color: 0.2, 0.2, 0.2, 1  # Gris foncé
            size_hint_y: None
            height: dp(25)

<CustomButton@Button>:
    size_hint: 0.45, None
    height: dp(40)
    font_name: "BPoppins"
    background_color: 0, 0, 0, 0  # Fond transparent (géré par le canvas)
    color: 1, 1, 1, 1  # Texte blanc
    canvas.before:
        Color:
            rgba: 0, 0.5, 1, 1  # Bleu
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [5]
    halign: "center"
    valign: "center"



<EmotionScreen>:
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1  # Fond blanc pur

        Image:
            source: "assets/emo_logo.png"
            size_hint_x: None
            width: dp(60)
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": .18, "center_y": .95}

        Image:
            source: "assets/space.png"
            size_hint: .8, .8
            pos_hint: {"center_x": .10, "center_y": .85}

        MDLabel:
            text: "HUMEUR selon emoDetect"
            font_name: "BPoppins"
            font_size: "15sp"
            pos_hint: {"center_y": .68}
            halign: "center"
            color: rgba(50, 50, 50, 255)  # Gris foncé pour un contraste agréable

        # En-tête avec l'émotion prédite
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            padding: [dp(20), 0]
            pos_hint: {"center_x": .5, "center_y": .55}
            canvas.before:
                Color:
                    rgba: 0.9, 0.9, 0.9, 0.9  # Fond gris clair avec légère opacité
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)]

            MDLabel:
                id: emotion_label
                text: 'Émotion détectée :' 
                color: 0.1, 0.3, 0.6, 1  # Bleu foncé
                font_size: '18sp'
                bold: True
                halign: "center"

        # Bouton Playlist
        Button:
            text: "PLAYLIST"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .4}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            color: 1, 1, 1, 1  # Texte blanc
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "playlist" 
            canvas.before:
                Color:
                    rgba: 0, 0.5, 1, 1  # Bleu vif
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [dp(10)]

        # Bouton Camera
        Button:
            text: "CAMERA"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .3}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            color: 1, 1, 1, 1  # Texte blanc
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "capture"
            canvas.before:
                Color:
                    rgba: 0.5, 0.5, 0.5, 1  # Gris neutre
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [dp(10)]

        # Bouton Dashboard
        Button:
            text: "DASHBOARD"
            size_hint: .66, .065
            pos_hint: {"center_x": .5, "center_y": .2}
            background_color: 0, 0, 0, 0
            font_name: "BPoppins"
            color: 1, 1, 1, 1  # Texte blanc
            on_release:
                root.manager.transition.direction = "left"
                root.manager.current = "space"
            canvas.before:
                Color:
                    rgba: 0, 0.5, 1, 1  # Bleu vif
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [dp(10)]


                        
<SongItem@BoxLayout>:
    orientation: 'horizontal'
    spacing: dp(10)
    padding: dp(10)
    size_hint_y: None
    height: dp(80)
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.95, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10)]

    song: ''
    artiste: ''
    album: ''
    genre: ''
    cover: ''

    AsyncImage:
        source: root.cover
        size_hint_x: None
        width: dp(60)
        allow_stretch: True
        keep_ratio: True

    BoxLayout:
        orientation: 'vertical'
        spacing: dp(2)
        
        Label:
            text: root.song
            font_size: '16sp'
            bold: True
            color: 0.2, 0.2, 0.2, 1
            text_size: self.width, None
            halign: 'left'
            size_hint_y: None
            height: self.texture_size[1]

        Label:
            text: root.artiste
            font_size: '14sp'
            color: 0.4, 0.4, 0.4, 1
            text_size: self.width, None
            halign: 'left'
            size_hint_y: None
            height: self.texture_size[1]

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(20)
            spacing: dp(10)

            Label:
                text: root.album
                font_size: '12sp'
                color: 0.5, 0.5, 0.5, 1
                text_size: self.width, None
                halign: 'left'
                size_hint_x: 0.4

            Label:
                text: root.genre
                font_size: '12sp'
                color: 0.6, 0.6, 0.6, 1
                text_size: self.width, None
                halign: 'left'
                size_hint_x: 0.3
    MDIconButton:
        icon: "play"
        on_release: app.root.get_screen('playlist').play_on_spotify(root.spotify_uri)


<PlaylistEmotionScreen>:
    recycleView: recycleView

    BoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10)
        canvas.before:
            Color:
                rgba: 0.98, 0.98, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # En-tête avec l'émotion prédite
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            padding: [dp(20), 0]
            canvas.before:
                Color:
                    rgba: 0.9, 0.9, 0.9, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)]

            Label:
                text: f"Playlist selon votre humeur : {root.prediction}"
                font_size: '18sp'
                bold: True
                color: 0.2, 0.2, 0.2, 1

        # Message d'erreur (si nécessaire)
        Label:
            size_hint_y: None
            height: dp(30) if root.error_str else 0
            text: root.error_str
            color: 1, 0, 0, 1
            opacity: 1 if root.error_str else 0

        # Liste des chansons
        RecycleView:
            id: recycleView
            viewclass: 'SongItem'
            effect_cls: "ScrollEffect"
            bar_width: dp(10)
            scroll_type: ['bars']
            
            RecycleBoxLayout:
                default_size: None, dp(80)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                spacing: dp(10)
                padding: dp(10)

        # Bouton Listen Music
        Button:
            size_hint_y: None
            height: dp(50)
            text: 'Dashboard'
            on_press: root.manager.current = 'space'

<PlaylistWidget@BoxLayout>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(60)
    song: ''
    artiste: ''
    album: ''
    genre: ''
    
    Label:
        text: root.song
    Label:
        text: root.artiste
    Label:
        text: root.album
    Label:
        text: root.genre
    Button:
        text: 'Camera'
        size_hint_y: None
        height: '48dp'
        on_press: root.manager.current = 'capture'
        background_color: 0.3, 0.3, 0.3, 1  
        color: 0, 1, .7, 1  # Texte blanc


<RotatingImage@FitImage>:
    angle: 0
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            origin: self.center
    canvas.after:
        PopMatrix


<HistoricScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)
        canvas.before:
            Color:
                rgba: 0.95, 0.95, 0.95, 1  # Fond gris clair pour un look moderne
            Rectangle:
                pos: self.pos
                size: self.size

        MDLabel:
            text: f"Playlists disponibles : {root.playlist_count}"
            font_name : "fonts/Lcd.ttf"
            color : 1, 0.5, 0.9, 1
            font_size: "25sp"
            halign: "center"
            color: 0.1, 0.3, 0.6, 1  # Bleu foncé pour le texte
            size_hint_y: None
            height: dp(30)

        MDRaisedButton:
            text: "Actualiser Liste de playlists"
            size_hint: 0.8, None
            height: dp(50)
            pos_hint: {"center_x": 0.5}
            md_bg_color: 0, 0.5, 1, 1  # Bleu vif pour le bouton
            text_color: 1, 1, 1, 1  # Texte blanc
            font_name: "BPoppins"
            on_release: root.update_file_list()

        RecycleView:
            id: file_list
            viewclass: 'PlaylistFileButton'
            data: []
            RecycleBoxLayout:
                default_size: None, dp(50)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                spacing: dp(5)
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1  # Fond blanc pour chaque élément
                    Rectangle:
                        pos: self.pos
                        size: self.size

        MDRaisedButton:
            text: "Dashboard"
            size_hint: 0.8, None
            height: dp(48)
            pos_hint: {"center_x": 0.5}
            md_bg_color: 0.3, 0.3, 0.3, 1  # Gris foncé pour différencier
            text_color: 1, 1, 1, 1  # Texte blanc
            font_name: "BPoppins"
            on_press: root.manager.current = "space"




<PlaylistFileButton>:
    size_hint_y: None
    height: dp(50)
    text: ''  # Cette propriété sera mise à jour par les données du RecycleView
    on_release: app.root.get_screen('historic').open_file(self.text)
    background_normal: ''
    background_color: 0.95, 0.95, 0.95, 1
    color: 0, 0, 0, 1



<PlayerSongScreen>:
    MDFloatLayout:
        md_bg_color: 1, 1, 1, 1
        MDIconButton:
            icon: "arrow-left"
            pos_hint: {"center_x": .1, "center_y": .95}
            user_font_size: "30sp"
            theme_text_color: "Custom"
            text_color: rgba(26, 24, 58, 255)
            on_release:
                root.manager.transition.direction = "right"
                root.manager.current = "playlist"
    EffectWidget:
        effects: [ew.VerticalBlurEffect(size=10), ew.HorizontalBlurEffect(size=10)]
        FitImage:
            source: 'assets/1.jpg'

    MDBoxLayout:
        orientation:'vertical'
        padding:['10dp', '30dp', '10dp', '50dp']
        SongCover:
            id:sc
            size:(250,250)
            size_hint: None, None
            pos_hint: {'center_x':.5}
            RotatingImage:
                angle:sc.angle
                source: 'assets/1.jpg'
                radius: [250,]

        AsyncImage:
            id: cover_image
            source: root.current_cover
            size: self.parent.size
            pos: self.parent.pos
            allow_stretch: True
            keep_ratio: True
            radius: [125, ]

        Widget:
            size_hint: None, None
            height: '25dp'
        
        MDLabel:
            text: root.current_artist
            halign: 'center'
            font_style: 'Subtitle1'
                
        MDLabel:
            text: root.current_album
            halign: 'center'
            font_style: 'Caption'

        MDBoxLayout:
            orientation: 'horizontal'
            adaptive_height: True
            spacing: '10dp'
            padding: ['20dp', '20dp']
                
            MDIconButton:
                icon: 'skip-previous'
                on_release: root.previous_track()
                    
            MDIconButton:
                icon: 'play-pause'
                on_release: root.toggle_play()
                    
            MDIconButton:
                icon: 'skip-next'
                on_release: root.next_track()
                    
        MDRaisedButton:
            text: "Ouvrir dans Spotify"
            pos_hint: {'center_x': .5}
            on_release: root.open_in_spotify()
            
        MDBoxLayout:
            orientation:'vertical'
            Slider:
                id:progress
                color:[.7,0,0,1]
                min:0
                max:100
                value:0
                background_width:'20dp'
                cursor_image:''
                cursor_size: ('10dp', '10dp')
                value_track_color:[0,0,0,1]
                value_track:True
            MDBoxLayout:
                MyIcon:
                    icon: 'restart'
                MyIcon:
                    icon: 'skip-previous-outline'
                MyIcon:
                    icon: 'skip-backward-outline'
                MyIcon:
                    icon: 'play-outline'
                    on_press: sc.play(progress)
                MyIcon:
                    icon: 'skip-forward'
                MyIcon:
                    icon: 'skip-next-outline'
                MyIcon:
                    icon: 'format-list-bulleted'
        Button:
            text: 'Dashboard'
            size_hint_y: None
            height: '48dp'
            on_press: root.manager.current = 'space'
            background_color: 0.3, 0.3, 0.3, 1  
            color: 0.5, 0.8, 0.1, 0.5 


<MyIcon@MDIconButton>:
    color:[.7,0,0,1]
    size_hint:None,None
    user_font_size: '20sp'
    theme_text_color: 'Custom'
    size:('20dp', '20dp')
    text_color:[1, 1, 1, 1]

<RotatingImage@FitImage>:
    angle:45
    canvas.before:
        PushMatrix
        Rotate:
            angle:root.angle
            origin:self.center
    canvas.after:
        PopMatrix


#Version definitive

<PlaylistDetailScreen>:
    recycleView: recycleView

    BoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10)
        canvas.before:
            Color:
                rgba: 0.98, 0.98, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # Liste des chansons
        RecycleView:
            id: recycleView
            viewclass: 'SongItem'
            effect_cls: "ScrollEffect"
            bar_width: dp(10)
            scroll_type: ['bars']
            
            RecycleBoxLayout:
                default_size: None, dp(80)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                spacing: dp(10)
                padding: dp(10)

        # Bouton Listen Music
        Button:
            size_hint_y: None
            height: dp(50)
            text: 'Retour'
            on_press: root.manager.current = 'historic'
